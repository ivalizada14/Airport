/*==============================================================*/
/* DBMS name:      ORACLE Version 12c                           */
/* Created on:     02.03.2023 22:03:58                          */
/*==============================================================*/
alter table AIRLINEFLIGHT
   drop constraint FK_AIRLINEF_AIRLINEFL_AIRLINE;

alter table AIRLINEFLIGHT
   drop constraint FK_AIRLINEF_AIRLINEFL_FLIGHT;

alter table AIRLINESTAFF
   drop constraint FK_AIRLINES_AIRLINEST_AIRLINE;

alter table AIRLINESTAFF
   drop constraint FK_AIRLINES_SUPERVISE_AIRLINES;

alter table FLIGHT
   drop constraint FK_FLIGHT_FLIGHTGAT_GATE;

alter table FLIGHTPASSANGER
   drop constraint FK_FLIGHTPA_FLIGHTPAS_PASSENGE;

alter table FLIGHTPASSANGER
   drop constraint FK_FLIGHTPA_FLIGHTPAS_FLIGHT;

alter table GATE
   drop constraint FK_GATE_FLIGHTGAT_FLIGHT;

drop table AIRLINE cascade constraints;

drop index AIRLINEFLIGHT_FK;

drop index AIRLINEFLIGHT2_FK;

drop table AIRLINEFLIGHT cascade constraints;

drop index SUPERVISES_FK;

drop index AIRLINESTAFF_FK;

drop table AIRLINESTAFF cascade constraints;

drop index FLIGHTGATE_FK;

drop table FLIGHT cascade constraints;

drop index FLIGHTPASSANGER_FK;

drop index FLIGHTPASSANGER2_FK;

drop table FLIGHTPASSANGER cascade constraints;

drop index FLIGHTGATE2_FK;

drop table GATE cascade constraints;

drop table PASSENGER cascade constraints;

/*==============================================================*/
/* Table: AIRLINE                                               */
/*==============================================================*/
create table AIRLINE (
   AIRLINE_ID           VARCHAR2(5)           not null,
   NAME                 VARCHAR2(20),
   FLIGHTSPERDAY        INTEGER               not null,
   OWNINGCOUNTRY        VARCHAR2(15)          not null,
   constraint PK_AIRLINE primary key (AIRLINE_ID)
);

/*==============================================================*/
/* Table: AIRLINEFLIGHT                                         */
/*==============================================================*/
create table AIRLINEFLIGHT (
   AIRLINE_ID           VARCHAR2(5)           not null,
   FLIGHT_ID            VARCHAR2(6)           not null,
   constraint PK_AIRLINEFLIGHT primary key (AIRLINE_ID, FLIGHT_ID)
);

/*==============================================================*/
/* Index: AIRLINEFLIGHT2_FK                                     */
/*==============================================================*/
create index AIRLINEFLIGHT2_FK on AIRLINEFLIGHT (
   FLIGHT_ID ASC
);

/*==============================================================*/
/* Index: AIRLINEFLIGHT_FK                                      */
/*==============================================================*/
create index AIRLINEFLIGHT_FK on AIRLINEFLIGHT (
   AIRLINE_ID ASC
);

/*==============================================================*/
/* Table: AIRLINESTAFF                                          */
/*==============================================================*/
create table AIRLINESTAFF (
   STAFF_ID             NUMBER(6)           
      generated as identity ( start with 1 nocycle noorder)  not null,
   AIRLINE_ID           VARCHAR2(5)           not null,
   AIR_STAFF_ID         INTEGER               ,
   FULLNAME             VARCHAR2(40)          not null,
   DEPARTMENT           VARCHAR2(15)          not null,
   POSITION             VARCHAR2(20)          not null,
   constraint PK_AIRLINESTAFF primary key (STAFF_ID)
);

/*==============================================================*/
/* Index: AIRLINESTAFF_FK                                       */
/*==============================================================*/
create index AIRLINESTAFF_FK on AIRLINESTAFF (
   AIRLINE_ID ASC
);

/*==============================================================*/
/* Index: SUPERVISES_FK                                         */
/*==============================================================*/
create index SUPERVISES_FK on AIRLINESTAFF (
   AIR_STAFF_ID ASC
);

/*==============================================================*/
/* Table: FLIGHT                                                */
/*==============================================================*/
create table FLIGHT (
   FLIGHT_ID            VARCHAR2(6)           not null,
   CODE                 VARCHAR2(8),
   DEPARTUREFROM        VARCHAR2(15)          not null,
   ARRIVALTO            VARCHAR2(15)          not null,
   DEPARTURETIME        DATE                  not null,
   ARRIVALTIME          DATE,
   constraint PK_FLIGHT primary key (FLIGHT_ID)
);

/*==============================================================*/
/* Index: FLIGHTGATE_FK                                         */
/*==============================================================*/
create index FLIGHTGATE_FK on FLIGHT (
   CODE ASC
);

/*==============================================================*/
/* Table: FLIGHTPASSANGER                                       */
/*==============================================================*/
create table FLIGHTPASSANGER (
   PASSENGER_ID         CHAR(10)              not null,
   FLIGHT_ID            VARCHAR2(6)           not null,
   constraint PK_FLIGHTPASSANGER primary key (PASSENGER_ID, FLIGHT_ID)
);

/*==============================================================*/
/* Index: FLIGHTPASSANGER2_FK                                   */
/*==============================================================*/
create index FLIGHTPASSANGER2_FK on FLIGHTPASSANGER (
   FLIGHT_ID ASC
);

/*==============================================================*/
/* Index: FLIGHTPASSANGER_FK                                    */
/*==============================================================*/
create index FLIGHTPASSANGER_FK on FLIGHTPASSANGER (
   PASSENGER_ID ASC
);

/*==============================================================*/
/* Table: GATE                                                  */
/*==============================================================*/
create table GATE (
   CODE                 VARCHAR2(8)           not null,
   FLIGHT_ID            VARCHAR2(6)           ,
   TERMINAL             VARCHAR2(2)           not null,
   constraint PK_GATE primary key (CODE)
);

/*==============================================================*/
/* Index: FLIGHTGATE2_FK                                        */
/*==============================================================*/
create index FLIGHTGATE2_FK on GATE (
   FLIGHT_ID ASC
);

/*==============================================================*/
/* Table: PASSENGER                                             */
/*==============================================================*/
create table PASSENGER (
   PASSENGER_ID         CHAR(10)              not null,
   PASSPORTNO           VARCHAR2(15)          not null,
   FULLNAME             VARCHAR2(40)          not null,
   BIRTHDATE            DATE                  not null,
   constraint PK_PASSENGER primary key (PASSENGER_ID)
);

alter table AIRLINEFLIGHT
   add constraint FK_AIRLINEF_AIRLINEFL_AIRLINE foreign key (AIRLINE_ID)
      references AIRLINE (AIRLINE_ID);

alter table AIRLINEFLIGHT
   add constraint FK_AIRLINEF_AIRLINEFL_FLIGHT foreign key (FLIGHT_ID)
      references FLIGHT (FLIGHT_ID);

alter table AIRLINESTAFF
   add constraint FK_AIRLINES_AIRLINEST_AIRLINE foreign key (AIRLINE_ID)
      references AIRLINE (AIRLINE_ID);

alter table AIRLINESTAFF
   add constraint FK_AIRLINES_SUPERVISE_AIRLINES foreign key (AIR_STAFF_ID)
      references AIRLINESTAFF (STAFF_ID);

alter table FLIGHT
   add constraint FK_FLIGHT_FLIGHTGAT_GATE foreign key (CODE)
      references GATE (CODE);

alter table FLIGHTPASSANGER
   add constraint FK_FLIGHTPA_FLIGHTPAS_PASSENGE foreign key (PASSENGER_ID)
      references PASSENGER (PASSENGER_ID);

alter table FLIGHTPASSANGER
   add constraint FK_FLIGHTPA_FLIGHTPAS_FLIGHT foreign key (FLIGHT_ID)
      references FLIGHT (FLIGHT_ID);

alter table GATE
   add constraint FK_GATE_FLIGHTGAT_FLIGHT foreign key (FLIGHT_ID)
      references FLIGHT (FLIGHT_ID);


/*Entering data to the tables AIRLINE and AIRLINESTAFF*/
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('AA001', 'American Airlines', 100, 'USA');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('DL002', 'Delta Airlines', 75, 'USA');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('UA003', 'United Airlines', 90, 'USA');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('EK004', 'Emirates', 120, 'UAE');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('SQ005', 'Singapore Airlines', 80, 'Singapore');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('QF006', 'Qantas Airways', 70, 'Australia');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('BA007', 'British Airways', 110, 'UK');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('AF008', 'Air France', 85, 'France');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('LH009', 'Lufthansa', 95, 'Germany');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('EK010', 'Etihad Airways', 70, 'UAE');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('TK011', 'Turkish Airlines', 80, 'Turkey');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('MH012', 'Malaysia Airlines', 60, 'Malaysia');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('AC013', 'Air Canada', 65, 'Canada');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('CX014', 'Cathay Pacific', 90, 'Hong Kong');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('KE015', 'Korean Air', 55, 'South Korea');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('NH016', 'All Nippon Airways', 75, 'Japan');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('DL017', 'Delta Connection', 40, 'USA');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('UA018', 'United Express', 45, 'USA');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('AI020', 'Air India', 50, 'India');
INSERT INTO AIRLINE (AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY) VALUES ('EY021', 'Air Arabia', 30, 'UAE');

INSERT INTO AIRLINESTAFF (AIRLINE_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('AA001', 'John Smith', 'Pilot', 'Captain');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('AA001', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Jane Doe', 'Pilot', 'First Officer');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('AA001', (select STAFF_ID from AIRLINESTAFF where fullname = 'Jane Doe'), 'Mike Johnson', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('AA001', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Lisa Chen', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('DL002', (select STAFF_ID from AIRLINESTAFF where fullname = 'Jane Doe'), 'David Lee', 'Pilot', 'Captain');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('DL002', (select STAFF_ID from AIRLINESTAFF where fullname = 'Fatima Ahmed'), 'Amy Wang', 'Pilot', 'First Officer');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('DL002', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Emily Chen', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('DL002', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Tom Smith', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA003', (select STAFF_ID from AIRLINESTAFF where fullname = 'Mike Johnson'), 'Jessica Kim', 'Pilot', 'Captain');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA003', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Ryan Lee', 'Pilot', 'First Officer');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA003', (select STAFF_ID from AIRLINESTAFF where fullname = 'Fatima Ahmed'), 'Rachel Brown', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA003', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Adam Jones', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('EK004', (select STAFF_ID from AIRLINESTAFF where fullname = 'Fatima Ahmed'), 'Mohammed Ali', 'Pilot', 'Captain');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('EK004', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'Fatima Ahmed', 'Pilot', 'First Officer');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('EK004', (select STAFF_ID from AIRLINESTAFF where fullname = 'Mike Johnson'), 'Ali Khan', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA018', (select STAFF_ID from AIRLINESTAFF where fullname = 'John Smith'), 'William Brown', 'Pilot', 'Captain');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA018', (select STAFF_ID from AIRLINESTAFF where fullname = 'Mike Johnson'), 'Sophie Smith', 'Pilot', 'First Officer');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA018', (select STAFF_ID from AIRLINESTAFF where fullname = 'Amy Wang'), 'Olivia Wilson', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('UA018', (select STAFF_ID from AIRLINESTAFF where fullname = 'Mohammed Ali'), 'George Anderson', 'Cabin Crew', 'Flight Attendant');
INSERT INTO AIRLINESTAFF (AIRLINE_ID, AIR_STAFF_ID, FULLNAME, DEPARTMENT, POSITION) VALUES ('KE015', (select STAFF_ID from AIRLINESTAFF where fullname = 'Amy Wang'), 'Jason Tan', 'Pilot', 'Captain');


/*INDEXES*/ 
/*Heap-Organized Table. Two tables that are linked by one to many (1: N)*/

/*Retrieve all records*/
SELECT * FROM AIRLINESTAFF;
 /*Retrieve the total number of records*/
SELECT COUNT(*) FROM AIRLINESTAFF;
/*Retrieve one record*/
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

/*B-Tree Index*/
CREATE INDEX IDX_AIRLINE_FLIGHTS ON AIRLINE(FLIGHTSPERDAY);
CREATE INDEX IDX_AIRLINESTAFF_FULLNAME ON AIRLINESTAFF(FULLNAME);

SELECT * FROM AIRLINESTAFF;
SELECT COUNT(*) FROM AIRLINESTAFF;
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

DROP INDEX IDX_AIRLINE_FLIGHTS;
DROP INDEX IDX_AIRLINESTAFF_FULLNAME;

/*Bitmap Join Index*/
CREATE BITMAP INDEX BK_AIRLINE_AIRLINESTAFF
ON AIRLINESTAFF (AIRLINE_ID)
FROM AIRLINE, AIRLINESTAFF
WHERE AIRLINE.AIRLINE_ID = AIRLINESTAFF.AIRLINE_ID;

SELECT * FROM AIRLINESTAFF;
SELECT COUNT(*) FROM AIRLINESTAFF;
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

DROP INDEX BK_AIRLINE_AIRLINESTAFF;

/*Indexed Cluster*/
CREATE CLUSTER AIRLINE_STAFF_CLUSTER
  (AIRLINE_ID VARCHAR2(5)) SIZE 256;

CREATE INDEX AIRLINE_CLUSTER_INDEX
  ON CLUSTER AIRLINE_STAFF_CLUSTER;
  
SELECT * FROM AIRLINESTAFF;
SELECT COUNT(*) FROM AIRLINESTAFF;
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

DROP CLUSTER AIRLINE_STAFF_CLUSTER;
  
/*Hash Cluster*/
  
CREATE CLUSTER AIRLINE_S_CLUSTER
(AIRLINE_ID NUMBER(4)) SIZE 8192 HASHKEYS 100;

SELECT * FROM AIRLINESTAFF;
SELECT COUNT(*) FROM AIRLINESTAFF;
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

DROP CLUSTER AIRLINE_S_CLUSTER;

/*Index organized tables*/
CREATE TABLE airline_staff_io
(
  CUSTOMER_ID NUMBER(6,0) PRIMARY KEY,
  FULL_NAME VARCHAR2(50),
  EMAIL_ VARCHAR2(100)
)
ORGANIZATION INDEX;

SELECT * FROM AIRLINESTAFF;
SELECT COUNT(*) FROM AIRLINESTAFF;
SELECT * FROM AIRLINESTAFF WHERE FULLNAME = 'Jane Doe';

DROP TABLE airline_staff_io;


/*Insterting into the tables */

/*FLIGHT Table
Here I am not inserting values to CODE column since it is a foreign key to GATE table. I will update it add values to CODE later*/
INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL001', 'New York', 'London', TO_DATE('2023-04-18 13:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-18 19:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL002', 'Paris', 'Rome', TO_DATE('2023-04-18 09:15:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-18 11:30:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL003', 'London', 'New York', TO_DATE('2023-04-19 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-19 15:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL004', 'Rome', 'Paris', TO_DATE('2023-04-19 14:20:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-19 16:35:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL005', 'New York', 'London', TO_DATE('2023-04-20 13:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-20 19:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL006', 'Paris', 'Rome', TO_DATE('2023-04-20 09:15:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-20 11:30:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL007', 'London', 'New York', TO_DATE('2023-04-21 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-21 15:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL008', 'Los Angeles', 'Chicago', TO_DATE('2023-04-21 07:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-21 13:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL009', 'New York', 'London', TO_DATE('2023-04-22 13:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-22 19:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL010', 'Paris', 'Rome', TO_DATE('2023-04-22 09:15:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-22 11:30:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL011', 'London', 'New York', TO_DATE('2023-04-23 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-23 15:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL012', 'Rome', 'Paris', TO_DATE('2023-04-23 14:20:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-23 16:35:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL013', 'New York', 'London', TO_DATE('2023-04-24 13:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-24 19:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL014', 'Paris', 'Rome', TO_DATE('2023-04-24 09:15:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-24 11:30:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL015', 'London', 'New York', TO_DATE('2023-04-25 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-25 15:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL016', 'Chicago', 'Los Angeles', TO_DATE('2023-04-23 16:20:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-23 22:35:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL017', 'New York', 'London', TO_DATE('2023-04-26 13:30:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-26 19:45:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL018', 'Paris', 'Rome', TO_DATE('2023-04-26 09:15:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-26 11:30:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL019', 'London', 'New York', TO_DATE('2023-04-27 08:45:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-27 15:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO FLIGHT(FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
VALUES ('FL020', 'Rome', 'Paris', TO_DATE('2023-04-27 14:20:00', 'YYYY-MM-DD HH24:MI:SS'), TO_DATE('2023-04-27 16:35:00', 'YYYY-MM-DD HH24:MI:SS'));


/*Gate Table*/

INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE01', 'A');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE02', 'B');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE03', 'C');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE04', 'D');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE05', 'A');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE06', 'B');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE07', 'C');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE08', 'D');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE09', 'A');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE10', 'B');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE11', 'C');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE12', 'D');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE13', 'A');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE14', 'B');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE15', 'C');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE16', 'D');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE17', 'A');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE18', 'B');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE19', 'C');
INSERT INTO GATE(CODE, TERMINAL) VALUES ('GATE20', 'D');

/*Updating the table Flight*/

UPDATE FLIGHT SET CODE='GATE01' WHERE FLIGHT_ID='FL001';
UPDATE FLIGHT SET CODE='GATE02' WHERE FLIGHT_ID='FL002';
UPDATE FLIGHT SET CODE='GATE03' WHERE FLIGHT_ID='FL003';
UPDATE FLIGHT SET CODE='GATE04' WHERE FLIGHT_ID='FL004';
UPDATE FLIGHT SET CODE='GATE05' WHERE FLIGHT_ID='FL005';
UPDATE FLIGHT SET CODE='GATE06' WHERE FLIGHT_ID='FL006';
UPDATE FLIGHT SET CODE='GATE07' WHERE FLIGHT_ID='FL007';
UPDATE FLIGHT SET CODE='GATE08' WHERE FLIGHT_ID='FL008';
UPDATE FLIGHT SET CODE='GATE09' WHERE FLIGHT_ID='FL009';
UPDATE FLIGHT SET CODE='GATE10' WHERE FLIGHT_ID='FL010';
UPDATE FLIGHT SET CODE='GATE11' WHERE FLIGHT_ID='FL011';
UPDATE FLIGHT SET CODE='GATE12' WHERE FLIGHT_ID='FL012';
UPDATE FLIGHT SET CODE='GATE13' WHERE FLIGHT_ID='FL013';
UPDATE FLIGHT SET CODE='GATE14' WHERE FLIGHT_ID='FL014';
UPDATE FLIGHT SET CODE='GATE15' WHERE FLIGHT_ID='FL015';
UPDATE FLIGHT SET CODE='GATE16' WHERE FLIGHT_ID='FL016';
UPDATE FLIGHT SET CODE='GATE17' WHERE FLIGHT_ID='FL017';
UPDATE FLIGHT SET CODE='GATE18' WHERE FLIGHT_ID='FL018';
UPDATE FLIGHT SET CODE='GATE19' WHERE FLIGHT_ID='FL019';
UPDATE FLIGHT SET CODE='GATE20' WHERE FLIGHT_ID='FL020';

/*Updating the table GATE*/
UPDATE GATE SET FLIGHT_ID = 'FL001' WHERE CODE = 'GATE01';
UPDATE GATE SET FLIGHT_ID = 'FL002' WHERE CODE = 'GATE02';
UPDATE GATE SET FLIGHT_ID = 'FL003' WHERE CODE = 'GATE03';
UPDATE GATE SET FLIGHT_ID = 'FL004' WHERE CODE = 'GATE04';
UPDATE GATE SET FLIGHT_ID = 'FL005' WHERE CODE = 'GATE05';
UPDATE GATE SET FLIGHT_ID = 'FL006' WHERE CODE = 'GATE06';
UPDATE GATE SET FLIGHT_ID = 'FL007' WHERE CODE = 'GATE07';
UPDATE GATE SET FLIGHT_ID = 'FL008' WHERE CODE = 'GATE08';
UPDATE GATE SET FLIGHT_ID = 'FL009' WHERE CODE = 'GATE09';
UPDATE GATE SET FLIGHT_ID = 'FL010' WHERE CODE = 'GATE10';
UPDATE GATE SET FLIGHT_ID = 'FL011' WHERE CODE = 'GATE11';
UPDATE GATE SET FLIGHT_ID = 'FL012' WHERE CODE = 'GATE12';
UPDATE GATE SET FLIGHT_ID = 'FL013' WHERE CODE = 'GATE13';
UPDATE GATE SET FLIGHT_ID = 'FL014' WHERE CODE = 'GATE14';
UPDATE GATE SET FLIGHT_ID = 'FL015' WHERE CODE = 'GATE15';
UPDATE GATE SET FLIGHT_ID = 'FL016' WHERE CODE = 'GATE16';
UPDATE GATE SET FLIGHT_ID = 'FL017' WHERE CODE = 'GATE17';
UPDATE GATE SET FLIGHT_ID = 'FL018' WHERE CODE = 'GATE18';
UPDATE GATE SET FLIGHT_ID = 'FL019' WHERE CODE = 'GATE19';
UPDATE GATE SET FLIGHT_ID = 'FL020' WHERE CODE = 'GATE20';

/*Inserting to PASSANGER table*/

INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P001', 'ABC123', 'John Smith', TO_DATE('1990-01-01', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P002', 'DEF456', 'Emily Johnson', TO_DATE('1992-02-02', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P003', 'GHI789', 'Michael Davis', TO_DATE('1985-03-03', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P004', 'JKL012', 'Jessica Lee', TO_DATE('1994-04-04', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P005', 'MNO345', 'David Wilson', TO_DATE('1988-05-05', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P006', 'PQR678', 'Sarah Brown', TO_DATE('1991-06-06', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P007', 'STU901', 'Kevin Martinez', TO_DATE('1997-07-07', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P008', 'VWX234', 'Michelle Kim', TO_DATE('1986-08-08', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P009', 'YZA567', 'William Thompson', TO_DATE('1993-09-09', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P010', 'BCD890', 'Alexis Davis', TO_DATE('1990-10-10', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P011', 'EFG123', 'Christopher Wilson', TO_DATE('1987-11-11', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P012', 'HIJ456', 'Olivia Jackson', TO_DATE('1995-12-12', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('P013', 'KLM789', 'Andrew Lee', TO_DATE('1989-01-13', 'YYYY-MM-DD'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG014', 'N456789', 'Michael Brown', TO_DATE('1965-12-30', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG015', 'P567890', 'Sarah Davis', TO_DATE('1992-08-18', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG016', 'Q678901', 'John Wilson', TO_DATE('1987-05-01', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG017', 'R789012', 'Karen Thompson', TO_DATE('1976-02-14', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG018', 'S890123', 'Daniel Johnson', TO_DATE('1989-11-23', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG019', 'T901234', 'Emily Martin', TO_DATE('1996-04-09', 'yyyy-mm-dd'));
INSERT INTO PASSENGER(PASSENGER_ID, PASSPORTNO, FULLNAME, BIRTHDATE) VALUES ('PSG020', 'U012345', 'Richard Garcia', TO_DATE('1968-07-03', 'yyyy-mm-dd'));

/*Inserting into AIRLINEFLIGHT table*/
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('AA001', 'FL001');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('DL002', 'FL001');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('UA003', 'FL001');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('BA007', 'FL001');

INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('AA001', 'FL002');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('DL002', 'FL002');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('AF008', 'FL002');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('LH009', 'FL002');

INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('AA001', 'FL003');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('DL002', 'FL003');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('UA003', 'FL003');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('BA007', 'FL003');

INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('EK004', 'FL004');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('SQ005', 'FL004');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('TK011', 'FL004');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('CX014', 'FL004');

INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('EK004', 'FL005');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('SQ005', 'FL005');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('TK011', 'FL005');
INSERT INTO AIRLINEFLIGHT (AIRLINE_ID, FLIGHT_ID) VALUES ('CX014', 'FL005');

/*Inserting into FLIGHTPASSANGER*/

INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P001', 'FL001');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P002', 'FL001');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P003', 'FL001');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P004', 'FL002');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P005', 'FL002');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P005', 'FL011');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P005', 'FL003');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P005', 'FL004');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P005', 'FL008');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P006', 'FL002');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P007', 'FL003');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P008', 'FL003');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P009', 'FL012');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P009', 'FL011');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P009', 'FL003');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P010', 'FL004');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P011', 'FL004');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P012', 'FL004');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('P013', 'FL005');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG014', 'FL005');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG015', 'FL005');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG016', 'FL006');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG017', 'FL006');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG018', 'FL006');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG019', 'FL007');
INSERT INTO FLIGHTPASSANGER(PASSENGER_ID, FLIGHT_ID) VALUES ('PSG020', 'FL007');



/*Query#1*/
/*Query goal: To see how many fights departed from or arrived to Paris*/
SELECT COUNT(*) FROM FLIGHT WHERE DEPARTUREFROM = 'Paris' OR ARRIVALTO='Paris';

/*Query#2*/
/*Query goal: to retrieve information about the flights that depart from the terminal ‘T1’ between the dates 2023-05-01 and 2023-05-31, along with the corresponding gate information.*/
SELECT f.FLIGHT_ID, f.CODE as GATE_CODE, f.DEPARTUREFROM, f.DEPARTURETIME, g.TERMINAL
FROM FLIGHT f, GATE g WHERE f.FLIGHT_ID = g.FLIGHT_ID
AND g.TERMINAL = 'A'
AND f.DEPARTURETIME BETWEEN TO_DATE('2023-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND TO_DATE('2023-05-31 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
ORDER BY f.DEPARTURETIME;

/*Query#3*/
/*Query goal: To analyze the number of flights departing from each location and their average flight duration.*/
SELECT DEPARTUREFROM, COUNT(*) as Number_of_Flights, AVG((ARRIVALTIME-DEPARTURETIME) * 24 * 60) as Avg_Flight_Duration 
FROM FLIGHT
GROUP BY DEPARTUREFROM;

/*Query#4*/
/*Query goal: To identify top 5 cities with the most flights arriving to them.*/
SELECT FLIGHT.ARRIVALTO, COUNT(*) AS NUM_FLIGHTS
FROM FLIGHT, GATE WHERE FLIGHT.FLIGHT_ID = GATE.FLIGHT_ID
GROUP BY FLIGHT.ARRIVALTO
ORDER BY NUM_FLIGHTS DESC
FETCH FIRST 5 ROWS ONLY;

/*Query#5*/
/*Query goal: to find the number of airlines in each country that have the word "Air" in their name, and only include countries whose airlines make more than 50 flights together per day.*/
SELECT OWNINGCOUNTRY, COUNT(*) AS NUMBER_OF_AIRLINES, SUM(FLIGHTSPERDAY) as FLIGHTS_PER_DAY
FROM AIRLINE
WHERE NAME LIKE '%Air%'
GROUP BY OWNINGCOUNTRY
HAVING SUM(FLIGHTSPERDAY) > 50
ORDER BY SUM(FLIGHTSPERDAY) DESC;


/*Query#6*/
/*Query goal: To find the number of staff members for each country that owns an airline and only show the results for countries that have more than 1 staff member.*/
SELECT a.OWNINGCOUNTRY, COUNT(*) AS NUM_STAFF
FROM AIRLINE a, AIRLINESTAFF s WHERE a.AIRLINE_ID = s.AIRLINE_ID
GROUP BY a.OWNINGCOUNTRY
HAVING COUNT(*) > 1;

/*Query#7*/
/*Query goal: This query will give us passenger’s name and surname separately along with passanger ID, passport number and number of flight he/she has taken so far.*/
SELECT 
    P.PASSENGER_ID,
    SUBSTR(P.FULLNAME, 1, INSTR(P.FULLNAME, ' ') - 1) AS NAME,
    SUBSTR(P.FULLNAME, INSTR(P.FULLNAME, ' ') + 1) AS SURNAME,
    P.PASSPORTNO,
    COUNT(FP.FLIGHT_ID) AS FLIGHT_COUNT
FROM 
    PASSENGER P, FLIGHTPASSANGER FP WHERE P.PASSENGER_ID = FP.PASSENGER_ID
GROUP BY 
    P.PASSENGER_ID, 
    P.FULLNAME,
    P.PASSPORTNO
ORDER BY 
    FLIGHT_COUNT DESC;

/*Query#8*/
/*GOAL: This query selects the name of the airline, the flight code, the full name of the passengers cities who have flown on flights departing from or arriving to New York and were born before January 1st, 1997. 
It only includes the airlines that are owned by the USA. It also includes departure and arrival cities. */
SELECT a.NAME AS airline_name, f.DEPARTUREFROM AS departure_from, f.ARRIVALTO AS arrival_to ,p.FULLNAME AS passenger_name
FROM (
    SELECT *
    FROM AIRLINE
    WHERE OWNINGCOUNTRY = 'USA'
) a,  AIRLINEFLIGHT af, FLIGHT f, FLIGHTPASSANGER fp, PASSENGER p
WHERE a.AIRLINE_ID = af.AIRLINE_ID
AND af.FLIGHT_ID = f.FLIGHT_ID
AND f.FLIGHT_ID = fp.FLIGHT_ID
AND fp.PASSENGER_ID = p.PASSENGER_ID
AND (f.DEPARTUREFROM = 'New York' OR f.ARRIVALTO = 'New York') AND p.BIRTHDATE < DATE '1997-01-01'
ORDER BY a.NAME, f.CODE, p.FULLNAME;

/*Query#9*/
/*Query goal: This query retrieves the details of passengers who have flown from a gate in terminal A and whose most recent flight departure was from New York.*/
SELECT DISTINCT p.fullname, f.code, f.departurefrom, f.arrivalto, f.departuretime
FROM passenger p, flightpassanger fp, flight f, gate g
WHERE p.passenger_id = fp.passenger_id 
AND fp.flight_id = f.flight_id 
AND f.flight_id = g.flight_id
AND g.terminal = 'A'
AND f.departuretime < (
  SELECT MAX(departuretime)
  FROM flight
  WHERE departurefrom = 'New York'
);

/*Query#10*/
/*Query goal: To find the airlines that have at least one flight with more than 3 passengers.*/
SELECT a.NAME
FROM AIRLINE a, AIRLINEFLIGHT af, FLIGHTPASSANGER fp
WHERE a.AIRLINE_ID = af.AIRLINE_ID
AND af.FLIGHT_ID = fp.FLIGHT_ID
AND fp.PASSENGER_ID IS NOT NULL
GROUP BY a.NAME
HAVING MAX(
    (SELECT COUNT(*)
     FROM FLIGHTPASSANGER fp2
     WHERE fp2.FLIGHT_ID = af.FLIGHT_ID)
) > 3;

/*Query#11*/
/*Query goal: The query is aimed to extract details of passengers along with the airline they flew with and details of staff members along with airline they are working for in the same table*/
SELECT PASSENGER.PASSENGER_ID as ID, PASSENGER.FULLNAME as FULLNAME, AIRLINE.NAME AS AIRLINE
FROM PASSENGER, FLIGHTPASSANGER, AIRLINEFLIGHT, AIRLINE 
WHERE PASSENGER.PASSENGER_ID = FLIGHTPASSANGER.PASSENGER_ID
AND FLIGHTPASSANGER.FLIGHT_ID = AIRLINEFLIGHT.FLIGHT_ID
AND AIRLINEFLIGHT.AIRLINE_ID = AIRLINE.AIRLINE_ID
UNION
SELECT CAST(AIRLINESTAFF.STAFF_ID AS varchar(12)) as ID, AIRLINESTAFF.FULLNAME as FULLNAME, AIRLINE.NAME AS AIRLINE
FROM AIRLINESTAFF, AIRLINE 
WHERE AIRLINESTAFF.AIRLINE_ID = AIRLINE.AIRLINE_ID;

/*Query#12*/
/*Query goal: To extract the name of airlines that do not have any flight from new york*/
SELECT NAME
FROM AIRLINE
MINUS
SELECT DISTINCT a.NAME
FROM AIRLINE a, AIRLINEFLIGHT af, FLIGHT f
WHERE a.AIRLINE_ID = af.AIRLINE_ID
AND af.FLIGHT_ID = f.FLIGHT_ID
AND f.DEPARTUREFROM = 'New York';

/*Query#13*/
/*Query goal: To extract the name of the airlines that has at least one flight from Paris*/
SELECT DISTINCT a.NAME 
FROM AIRLINE a, AIRLINEFLIGHT af, FLIGHT f
WHERE a.AIRLINE_ID = af.AIRLINE_ID
AND af.FLIGHT_ID = f.FLIGHT_ID
AND EXISTS (
    SELECT 1 
    FROM FLIGHT f2 
    WHERE f2.DEPARTUREFROM = 'Paris' 
    AND f2.FLIGHT_ID = f.FLIGHT_ID
);

/*Query#14*/
/*Query goal: This query retrieves the name of the airline, flight ID, departure airport, and arrival airport for all flights.*/
SELECT AIRLINE.NAME, AIRLINEFLIGHT.FLIGHT_ID, FLIGHT.DEPARTUREFROM, FLIGHT.ARRIVALTO
FROM AIRLINE
INNER JOIN AIRLINEFLIGHT ON AIRLINE.AIRLINE_ID = AIRLINEFLIGHT.AIRLINE_ID
INNER JOIN FLIGHT ON AIRLINEFLIGHT.FLIGHT_ID = FLIGHT.FLIGHT_ID;

/*Query#15*/
/*Query goal: This query retrieves the name of the airline staff member, airline name, and department for all staff members.*/
SELECT AIRLINESTAFF.FULLNAME, AIRLINE.NAME, AIRLINESTAFF.DEPARTMENT
FROM AIRLINESTAFF
INNER JOIN AIRLINE ON AIRLINESTAFF.AIRLINE_ID = AIRLINE.AIRLINE_ID;

/*Query#16*/
/*Query goal: This query retrieves the full name of the passenger, departure airport, and arrival airport for all flights a passenger is booked on.*/
SELECT PASSENGER.FULLNAME, FLIGHT.DEPARTUREFROM, FLIGHT.ARRIVALTO
FROM PASSENGER
INNER JOIN FLIGHTPASSANGER ON PASSENGER.PASSENGER_ID = FLIGHTPASSANGER.PASSENGER_ID
INNER JOIN FLIGHT ON FLIGHTPASSANGER.FLIGHT_ID = FLIGHT.FLIGHT_ID;

/*Query#17*/
/*Query goal: This query aims to retrieve a list of all airlines with their respective flight IDs. 
A RIGHT JOIN is used here to include all records from the AIRLINEFLIGHT table, even if there is no matching record in the AIRLINE table.*/
SELECT a.AIRLINE_ID, a.NAME, b.FLIGHT_ID
FROM AIRLINE a
RIGHT JOIN AIRLINEFLIGHT b
ON a.AIRLINE_ID = b.AIRLINE_ID;


/*Query#18*/
/*Query goal: This query will retrieve all the rows from both the GATE and FLIGHT tables, and only the matching rows from the GATE table.*/
SELECT *
FROM GATE
RIGHT JOIN FLIGHT
ON GATE.FLIGHT_ID = FLIGHT.FLIGHT_ID;

/*Query#19*/
/*Query goal: This query aims to retrieve the full name of passengers and the code of flights they are on. 
It uses a RIGHT JOIN between the PASSENGER and FLIGHTPASSANGER tables, as well as a RIGHT JOIN between the FLIGHTPASSANGER and FLIGHT tables, which means that all records from the FLIGHT table will be included, and only matching records from the other tables will be included.*/
SELECT P.FULLNAME, F.CODE
FROM PASSENGER P
RIGHT JOIN FLIGHTPASSANGER FP ON P.PASSENGER_ID = FP.PASSENGER_ID
RIGHT JOIN FLIGHT F ON FP.FLIGHT_ID = F.FLIGHT_ID;

/*Query#20*/
/*Query goal: to retrieve all the airlines with their staff information.*/
SELECT a.AIRLINE_ID, a.NAME, s.FULLNAME, s.DEPARTMENT, s.POSITION
FROM AIRLINE a
LEFT JOIN AIRLINESTAFF s ON a.AIRLINE_ID = s.AIRLINE_ID;

/*Query#21*/
/*Query goal: To retrieve all the flights with their airline information.*/
SELECT f.FLIGHT_ID, f.CODE, a.NAME, a.OWNINGCOUNTRY
FROM FLIGHT f
LEFT JOIN AIRLINEFLIGHT af ON f.FLIGHT_ID = af.FLIGHT_ID
LEFT JOIN AIRLINE a ON af.AIRLINE_ID = a.AIRLINE_ID;

/*Query#22*/
/*Query goal: To retrieve all the gates with their flight and airline information.*/
SELECT g.CODE, f.FLIGHT_ID, a.NAME
FROM GATE g
LEFT JOIN FLIGHT f ON g.FLIGHT_ID = f.FLIGHT_ID
LEFT JOIN AIRLINEFLIGHT af ON f.FLIGHT_ID = af.FLIGHT_ID
LEFT JOIN AIRLINE a ON af.AIRLINE_ID = a.AIRLINE_ID;

/*-------------------------------------/*
/*Advanced SQL*/

/*Query #1*/
/*Query goal: To create a view that contains the data of passengers booked on each flight*/
CREATE VIEW flight_passenger_info AS
SELECT f.FLIGHT_ID, f.CODE, f.DEPARTUREFROM, f.ARRIVALTO, f.DEPARTURETIME, f.ARRIVALTIME, p.PASSENGER_ID, p.PASSPORTNO, p.FULLNAME, p.BIRTHDATE
FROM FLIGHT f
JOIN FLIGHTPASSANGER fp ON f.FLIGHT_ID = fp.FLIGHT_ID
JOIN PASSENGER p ON fp.PASSENGER_ID = p.PASSENGER_ID;

SELECT * FROM flight_passenger_info;

drop view flight_passenger_info;

/*Query #2*/
/*Query goal: To create a view that will contain the name of the airline and the full name and position of each staff member*/
CREATE VIEW airline_staff_info AS
SELECT al.NAME, ast.FULLNAME, ast.DEPARTMENT, ast.POSITION
FROM AIRLINESTAFF ast
JOIN AIRLINE al ON ast.AIRLINE_ID = al.AIRLINE_ID;

SELECT * FROM airline_staff_info;

drop view airline_staff_info;


/*Query #3*/
/*Query goal: To create a materialized view that contains the name of terminal and the number of flights departing from them. */
CREATE MATERIALIZED VIEW terminal_flight_counts
BUILD IMMEDIATE
REFRESH COMPLETE ON DEMAND
AS
SELECT g.TERMINAL, COUNT(f.FLIGHT_ID) AS FLIGHT_COUNT
FROM GATE g
LEFT JOIN FLIGHT f ON g.FLIGHT_ID = f.FLIGHT_ID
GROUP BY g.TERMINAL;

SELECT * FROM terminal_flight_counts;

drop MATERIALIZED VIEW terminal_flight_counts;

/*Query #4*/
/*Query goal: To create a materialized view that contains the total number of passengers per flight.*/
CREATE MATERIALIZED VIEW mv_passenger_count_by_flight
BUILD IMMEDIATE
REFRESH COMPLETE ON DEMAND
AS
SELECT f.FLIGHT_ID, f.CODE, COUNT(p.PASSENGER_ID) AS PASSENGER_COUNT
FROM FLIGHT f
JOIN FLIGHTPASSANGER fp ON f.FLIGHT_ID = fp.FLIGHT_ID
JOIN PASSENGER p ON fp.PASSENGER_ID = p.PASSENGER_ID
GROUP BY f.FLIGHT_ID, f.CODE;

SELECT * FROM mv_passenger_count_by_flight;

drop MATERIALIZED VIEW mv_passenger_count_by_flight;

/*Query #5*/
/*Query goal: To retrieve the duration of each flight in hours by subtracting the departure time from the arrival time and multiplying by 24. 
If the flight has not yet arrived, then the duration is equal to null.*/
SELECT 
  FLIGHT_ID, 
  DEPARTUREFROM, 
  ARRIVALTO, 
  TO_CHAR(DEPARTURETIME, 'DD-MON-YYYY HH24:MI:SS') AS DEPARTURE_TIME,
  TO_CHAR(ARRIVALTIME, 'DD-MON-YYYY HH24:MI:SS') AS ARRIVAL_TIME,
  (CASE 
    WHEN ARRIVALTIME IS NOT NULL THEN (24 * (ARRIVALTIME - DEPARTURETIME))
    ELSE NULL 
  END) AS DURATION_HOURS
FROM 
  FLIGHT;
  
/*Query #6*/
/*This query categorizes airline staff by their position, grouping them into "Flight Crew", "Ground Crew" and “Office Worker” categories, with any positions not included in these categories categorized as "Other".*/
SELECT 
  FULLNAME, 
  POSITION, 
  (CASE 
    WHEN POSITION = 'Captain' THEN 'Flight Crew'
    WHEN POSITION = 'Flight Attendant' THEN 'Flight Crew'
    WHEN POSITION = 'Maintenance' THEN 'Ground Crew'
    WHEN POSITION = 'First Officer' THEN 'Office Worker'
    ELSE 'Other' 
  END) AS POSITION_CATEGORY
FROM 
  AIRLINESTAFF;
  
/*Query #7*/
/*Query goal: To generate a hierarchical list of staff members and their supervisors from the AIRLINESTAFF table*/
SELECT 
    s1.FULLNAME AS staff_name, 
    s2.FULLNAME AS supervisor_name, 
    LEVEL AS hierarchy_level
FROM 
    AIRLINESTAFF s1
LEFT JOIN 
    AIRLINESTAFF s2 ON s1.AIR_STAFF_ID = s2.STAFF_ID
START WITH 
    s1.AIR_STAFF_ID IS NULL
CONNECT BY 
    PRIOR s1.STAFF_ID = s1.AIR_STAFF_ID;

/*Query #8*/
/*Query goal: To combine data from the FLIGHT and PASSENGER tables in a single table*/
WITH
  flight_data AS (
    SELECT FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME
    FROM FLIGHT
  ),
  passenger_data AS (
    SELECT PASSENGER_ID, FULLNAME, BIRTHDATE
    FROM PASSENGER
  )
SELECT FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME, NULL AS PASSENGER_ID, NULL AS FULLNAME, NULL AS BIRTHDATE
FROM flight_data
UNION ALL
SELECT NULL AS FLIGHT_ID, NULL AS DEPARTUREFROM, NULL AS ARRIVALTO, NULL AS DEPARTURETIME, NULL AS ARRIVALTIME, PASSENGER_ID, FULLNAME, BIRTHDATE
FROM passenger_data;

/*Query #9*/
/*Query goal: To rank the flights departing from each location by their departure time, assigning a rank of 1 to the flight with the earliest departure time.*/
SELECT 
  FLIGHT_ID,
  DEPARTUREFROM,
  DEPARTURETIME,
  RANK() OVER (PARTITION BY DEPARTUREFROM ORDER BY DEPARTURETIME ASC) AS "DEPARTURE_RANK"
FROM 
  FLIGHT;

/*Query #10*/
/*Query goal: To calculate the age of each passenger based on their birthdate, and assign them to an age bucket based on their age range (0-10, 10-20, etc.) and rank them  by age, with the oldest passenger receiving a rank of 1.*/
SELECT 
  FULLNAME,
  BIRTHDATE,
  WIDTH_BUCKET(2023 - EXTRACT(YEAR FROM BIRTHDATE), 0, 100, 10) AS "AGE_BUCKET",
  ROW_NUMBER() OVER (ORDER BY BIRTHDATE ASC) AS "AGE_RANK"
FROM 
  PASSENGER;

/*Query #11*/
/*Query goal: To calculate the total number of flights per airline*/
SELECT 
  AIRLINE_ID, 
  NAME, 
  FLIGHTSPERDAY,
  SUM(FLIGHTSPERDAY) OVER (
    ORDER BY AIRLINE_ID
    RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
  ) AS TOTAL_FLIGHTS
FROM 
  AIRLINE;

/*Query #12*/
/*Query goal: To get the total duration of each flight for all flights departing from a specific airport*/
SELECT 
  DEPARTUREFROM,
  FLIGHT_ID,
  DEPARTURETIME,
  ARRIVALTIME,
  SUM((ARRIVALTIME - DEPARTURETIME)*24) OVER (
    PARTITION BY DEPARTUREFROM 
    ORDER BY DEPARTURETIME 
    ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
  ) AS RUNNING_TOTAL_DURATION
FROM 
  FLIGHT;

/*Query #13*/
/*Query goal: This query will use GROUPING() and GROUPING SETS to calculate the total number of staff for each combination of airline, department, and position, as well as the total number of staff for each combination of airline and department.*/
SELECT AIRLINE.NAME, AIRLINESTAFF.DEPARTMENT, AIRLINESTAFF.POSITION, COUNT(*) AS TOTAL_STAFF
FROM AIRLINESTAFF
JOIN AIRLINE ON AIRLINESTAFF.AIRLINE_ID = AIRLINE.AIRLINE_ID
GROUP BY GROUPING SETS (
(AIRLINE.NAME, AIRLINESTAFF.DEPARTMENT, AIRLINESTAFF.POSITION),
(AIRLINE.NAME, AIRLINESTAFF.DEPARTMENT)
)
ORDER BY AIRLINE.NAME, AIRLINESTAFF.DEPARTMENT, AIRLINESTAFF.POSITION;



/*Query #14*/
/*Query goal: To group flights by their departure and arrival locations, and display the total number of flights for each combination, including subtotals by departure location, arrival location, and grand total.*/
SELECT DEPARTUREFROM, ARRIVALTO, COUNT(*) AS NUM_FLIGHTS,
    GROUPING(DEPARTUREFROM) AS GROUP_DEP,
    GROUPING(ARRIVALTO) AS GROUP_ARR,
    GROUPING_ID(DEPARTUREFROM, ARRIVALTO) AS GROUP_ID
FROM FLIGHT
GROUP BY CUBE(DEPARTUREFROM, ARRIVALTO)
ORDER BY GROUP_ID;

/*Query #15*/
/*Query goal: To change the number of flights per day in one flight.*/
SELECT *
FROM (
    SELECT AIRLINE_ID, NAME, FLIGHTSPERDAY, OWNINGCOUNTRY
    FROM AIRLINE 
)
MODEL 
    DIMENSION BY (AIRLINE_ID)
    MEASURES (NAME, FLIGHTSPERDAY, OWNINGCOUNTRY)
    RULES (
        FLIGHTSPERDAY['AA001'] = 200
    );


/*Query #16*/
/*Query goal: To increase the arrival time of all flights in the FLIGHT table by 1 hour.*/
SELECT *
FROM (
    SELECT FLIGHT_ID, DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME
    FROM FLIGHT
)
MODEL 
    DIMENSION BY (FLIGHT_ID)
    MEASURES (DEPARTUREFROM, ARRIVALTO, DEPARTURETIME, ARRIVALTIME)
    RULES (
        ARRIVALTIME['FL001'] = ADD_MONTHS(DEPARTURETIME['FL001'], 1/24)
    );

SET SERVEROUTPUT ON;

/*PL/SQL Queries*/
/*Task1*/
/*The following PL / SQL query overwrites the table PASSENGER adding ‘P’ to the passport numbers of all passengers*/
DECLARE
  CURSOR cursor IS
    SELECT *
    FROM PASSENGER;
BEGIN
  FOR data IN cursor LOOP
    UPDATE PASSENGER
    SET
      PASSPORTNO = 'P' || data.PASSPORTNO,
      FULLNAME = data.FULLNAME,
      BIRTHDATE = data.BIRTHDATE
    WHERE PASSENGER_ID = data.PASSENGER_ID;
  END LOOP;

  COMMIT;
END;
/

SELECT * FROM PASSENGER;

/*Task 2*/
/*The following query that creates TRIGGER that prints to the screen when the gate of the flight is changed.*/
CREATE OR REPLACE TRIGGER AFTER_UPDATE_FLIGHT
AFTER UPDATE ON FLIGHT
FOR EACH ROW
BEGIN
  DBMS_OUTPUT.PUT_LINE('Old GATE: ' || :OLD.CODE || ', New GATE: ' || :NEW.CODE);
END;
/

UPDATE FLIGHT
SET CODE = 'GATE02'
WHERE FLIGHT_ID = 'FL001';




/*Task 3*/
/*The following query creates a function into WITH clause that retrieves the number of passengers for each airline.*/
WITH FUNCTION getPassengerCountForAirline(p_airline_id IN AIRLINE.AIRLINE_ID%TYPE)
   RETURN INTEGER
IS
   v_passenger_count INTEGER := 0;
BEGIN
   SELECT COUNT(*) INTO v_passenger_count
   FROM PASSENGER p
   JOIN FLIGHTPASSANGER fp ON p.PASSENGER_ID = fp.PASSENGER_ID
   JOIN AIRLINEFLIGHT af ON fp.FLIGHT_ID = af.FLIGHT_ID
   WHERE af.AIRLINE_ID = p_airline_id;
   
   RETURN v_passenger_count;
EXCEPTION
   WHEN NO_DATA_FOUND THEN
      RETURN 0;
END;

SELECT AIRLINE_ID, getPassengerCountForAirline(AIRLINE_ID) AS passengerCount
FROM AIRLINE;
/


/*Task 4*/
/*The following query defines a procedure that takes a table as an input and selects all rows from the requested table and opens a cursor using dynamic SQL. 
Then it retrieves its rows and prints them. This query demonstrates the use of both dynamic SQL and dynamic PL/SQL*/
CREATE OR REPLACE PROCEDURE retrieve_table_records(table_name IN VARCHAR2)
IS
   l_sql_statement VARCHAR2(200);
   l_cursor        SYS_REFCURSOR;
   l_row           GATE%ROWTYPE;  
BEGIN
   l_sql_statement := 'SELECT * FROM ' || table_name;
   OPEN l_cursor FOR l_sql_statement;
   LOOP
      FETCH l_cursor INTO l_row;
      EXIT WHEN l_cursor%NOTFOUND;
      DBMS_OUTPUT.PUT_LINE(l_row.CODE || ', ' || l_row.FLIGHT_ID || ', ' || l_row.TERMINAL);
   END LOOP;
   CLOSE l_cursor;
EXCEPTION
   WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('An error occurred ');
END;
/


BEGIN
   retrieve_table_data('GATE');
END;
/








